{
  "name": "entrance-geo-test",
  "displayName": "入口 & 落地 检测",
  "form": "",
  "mergeSources": "",
  "ignoreFailedRemoteSub": false,
  "icon": "https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Lab.png",
  "process": [
    {
      "type": "Quick Setting Operator",
      "args": {
        "useless": "DISABLED",
        "udp": "ENABLED",
        "scert": "ENABLED",
        "tfo": "ENABLED",
        "vmess aead": "DEFAULT"
      }
    },
    {
      "type": "Regex Filter",
      "args": {
        "keep": false,
        "regex": [
          "^(#|\\/\\/)"
        ]
      },
      "id": "53433073.30347516"
    },
    {
      "type": "Resolve Domain Operator",
      "args": {
        "provider": "Google",
        "type": "IPv4",
        "filter": "disabled",
        "cache": "enabled"
      },
      "id": "40233010.57528247"
    },
    {
      "type": "Resolve Domain Operator",
      "args": {
        "provider": "Cloudflare",
        "type": "IPv6",
        "filter": "IPOnly",
        "cache": "enabled"
      },
      "id": "26345051.98838817"
    },
    {
      "type": "Script Operator",
      "args": {
        "content": "function operator(proxies = []) {\n    function removeDuplicates(arr, fields) {\n        const map = new Map()\n        return arr.filter(item => {\n            const key = fields.map(field => item[field]).join('-')\n            if (map.has(key)) {\n                return false\n            } else {\n                map.set(key, true)\n                return true\n            }\n        })\n    }\n    return removeDuplicates(proxies, ['server', 'port', 'type']).map(i => {\n      delete i._geo\n      delete i._entrance\n      return i\n    })\n}\n",
        "mode": "script"
      },
      "id": "95704959.8891461"
    },
    {
      "type": "Script Operator",
      "args": {
        "content": "https://raw.githubusercontent.com/xream/scripts/main/surge/modules/sub-store-scripts/check/entrance.js#entrance&timeout=1999&retries=1&remove_failed&cache",
        "mode": "link"
      },
      "id": "81096408.2142662"
    },
    {
      "type": "Script Operator",
      "args": {
        "content": "https://raw.githubusercontent.com/xream/scripts/main/surge/modules/sub-store-scripts/check/geo.js#geo&timeout=1999&retries=1&cache",
        "mode": "link"
      },
      "id": "13314308.521440443"
    },
    {
      "type": "Script Filter",
      "args": {
        "content": "return $server._geo && $server._entrance",
        "mode": "script"
      },
      "id": "75931717.50058809"
    },
    {
      "type": "Script Operator",
      "args": {
        "content": "\nconst { _entrance, _geo } = $server\n\nlet entranceFlag = ProxyUtils.getFlag(_entrance.country).replace(/🇹🇼/g, '🇼🇸')\nlet geoFlag = ProxyUtils.getFlag(_geo.country).replace(/🇹🇼/g, '🇼🇸')\n$server.name = (_entrance.isp !== _geo.isp || _entrance.country !== _geo.country) ? `${entranceFlag} ${_entrance.isp} ➮ ${geoFlag} ${_geo.isp} [${$server.type}]` : `${geoFlag} ${_geo.isp} [${$server.type}]`\n\ndelete $server._entrance\ndelete $server._geo",
        "mode": "script"
      },
      "id": "93023814.22544846"
    },
    {
      "type": "Sort Operator",
      "args": "asc",
      "id": "38897913.79490925"
    },
    {
      "type": "Handle Duplicate Operator",
      "args": {
        "action": "rename",
        "position": "back",
        "template": "⁰ ¹ ² ³ ⁴ ⁵ ⁶ ⁷ ⁸ ⁹",
        "link": ""
      },
      "id": "84882948.57123472"
    }
  ],
  "source": "local",
  "url": "",
  "content": "",
  "ua": "",
  "tag": [
    "检测"
  ],
  "display-name": "入口 & 落地 检测"
}